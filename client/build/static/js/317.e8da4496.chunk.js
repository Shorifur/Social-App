"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[317],{1317:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var a=s(5043),o=s(2266);var n=s(3884),r=s(5028),i=s(579);const c=()=>{const[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[l,d]=(0,a.useState)(1),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)("");(0,a.useEffect)(()=>{v()},[]);const v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{c(!0);const s=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await o.A.get("/social/posts/feed?page=".concat(e,"&limit=").concat(t))).data}(e);t(1===e?s.posts:e=>[...e,...s.posts]),m(s.hasMore),d(e)}catch(h){p("Failed to load feed"),console.error("Feed loading error:",h)}finally{c(!1)}};return s&&1===l?(0,i.jsx)("div",{className:"loading",children:"Loading feed..."}):(0,i.jsx)("div",{className:"feed-page",children:(0,i.jsx)("div",{className:"container",children:(0,i.jsxs)("div",{className:"feed-content",children:[(0,i.jsx)(r.A,{onPostCreated:e=>{t(t=>[e,...t])}}),h&&(0,i.jsx)("div",{className:"error-message",children:h}),(0,i.jsx)("div",{className:"posts-list",children:0===e.length?(0,i.jsxs)("div",{className:"empty-feed",children:[(0,i.jsx)("h3",{children:"Your feed is empty"}),(0,i.jsx)("p",{children:"Follow some users to see their posts here"})]}):e.map(e=>(0,i.jsx)(n.A,{post:e},e._id))}),u&&(0,i.jsx)("button",{onClick:()=>{u&&!s&&v(l+1)},disabled:s,className:"load-more-btn",children:s?"Loading...":"Load More"})]})})})}},1321:(e,t,s)=>{s.d(t,{A:()=>o});const a=s(9722).A.create({baseURL:"http://localhost:5000/api",timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});const o=a},2266:(e,t,s)=>{s.d(t,{A:()=>o});const a=s(9722).A.create({baseURL:"http://localhost:5000",timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});const o=a},3884:(e,t,s)=>{s.d(t,{A:()=>u});var a=s(2555),o=s(5043),n=s(2266);const r=async(e,t)=>{try{return(await n.A.post("/api/posts/".concat(e,"/reactions"),{type:t})).data}catch(a){var s;throw(null===(s=a.response)||void 0===s?void 0:s.data)||a}},i=async e=>{try{return(await n.A.delete("/api/posts/".concat(e,"/reactions"))).data}catch(s){var t;throw(null===(t=s.response)||void 0===t?void 0:t.data)||s}},c=async e=>{try{return(await n.A.get("/api/posts/".concat(e,"/reactions/me"))).data}catch(a){var t,s;if(404===(null===(t=a.response)||void 0===t?void 0:t.status))return null;throw(null===(s=a.response)||void 0===s?void 0:s.data)||a}};var l=s(6351),d=s(579);const u=e=>{var t,s,n,u;let{post:m,onComment:h}=e;const[p,v]=(0,o.useState)(null),[j,g]=(0,o.useState)(m.reactionCounts||{}),[x,f]=(0,o.useState)(!1),[N,w]=(0,o.useState)(""),[y,b]=(0,o.useState)(!1),{user:A}=(0,l.A)(),S=async()=>{try{const e=await c(m._id);v((null===e||void 0===e?void 0:e.userReaction)||null)}catch(e){console.error("Error loading user reaction:",e)}};(0,o.useEffect)(()=>{S()},[m._id,S]);const C=async e=>{try{if(p===e)await i(m._id),v(null),g(t=>(0,a.A)((0,a.A)({},t),{},{[e]:Math.max(0,(t[e]||0)-1)}));else{const t=await r(m._id,e);v(e),g(t.reactionCounts)}f(!1)}catch(t){console.error("Error handling reaction:",t)}},k=e=>{switch(e){case"like":default:return"\ud83d\udc4d";case"love":return"\u2764\ufe0f";case"haha":return"\ud83d\ude04";case"wow":return"\ud83d\ude32";case"sad":return"\ud83d\ude22";case"angry":return"\ud83d\ude20";case"dislike":return"\ud83d\udc4e"}},P=()=>Object.values(j).reduce((e,t)=>e+t,0),L=e=>new Date(e).toLocaleDateString("en-US",{hour:"2-digit",minute:"2-digit"});return(0,d.jsxs)("div",{className:"post-card",children:[(0,d.jsxs)("div",{className:"post-header",children:[(0,d.jsx)("img",{src:(null===(t=m.user)||void 0===t?void 0:t.profilePicture)||"/default-avatar.jpg",alt:null===(s=m.user)||void 0===s?void 0:s.firstName,className:"post-avatar"}),(0,d.jsxs)("div",{className:"post-user-info",children:[(0,d.jsxs)("h4",{children:[null===(n=m.user)||void 0===n?void 0:n.firstName," ",null===(u=m.user)||void 0===u?void 0:u.lastName]}),(0,d.jsx)("span",{className:"post-time",children:L(m.createdAt)})]})]}),(0,d.jsxs)("div",{className:"post-content",children:[(0,d.jsx)("p",{children:m.content}),m.image&&(0,d.jsx)("img",{src:m.image,alt:"Post",className:"post-image"})]}),(0,d.jsxs)("div",{className:"post-stats",children:[P()>0&&(0,d.jsxs)("span",{children:[P()," reactions"]}),(0,d.jsxs)("span",{children:[m.comments.length," comments"]})]}),(0,d.jsxs)("div",{className:"post-actions",children:[(0,d.jsxs)("button",{className:"action-btn ".concat(p?"active":""),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),onClick:()=>C("like"),children:[p?k(p):"\ud83d\udc4d"," ",p?"Reacted":"React"]}),(0,d.jsx)("button",{onClick:()=>b(!y),className:"action-btn",children:"\ud83d\udcac Comment"}),(0,d.jsx)("button",{className:"action-btn",children:"\ud83d\udd04 Share"})]}),x&&(0,d.jsx)("div",{className:"reaction-picker",onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:["like","love","haha","wow","sad","angry","dislike"].map(e=>(0,d.jsx)("button",{className:"reaction-option",onClick:()=>C(e),title:e.charAt(0).toUpperCase()+e.slice(1),children:k(e)},e))}),y&&(0,d.jsxs)("div",{className:"comments-section",children:[(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),N.trim()&&(h(m._id,N.trim()),w(""))},className:"comment-form",children:[(0,d.jsx)("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"Write a comment...",className:"comment-input"}),(0,d.jsx)("button",{type:"submit",disabled:!N.trim(),children:"Post"})]}),(0,d.jsx)("div",{className:"comments-list",children:m.comments.map(e=>{var t,s,a;return(0,d.jsxs)("div",{className:"comment",children:[(0,d.jsx)("img",{src:(null===(t=e.user)||void 0===t?void 0:t.profilePicture)||"/default-avatar.jpg",alt:null===(s=e.user)||void 0===s?void 0:s.firstName,className:"comment-avatar"}),(0,d.jsxs)("div",{className:"comment-content",children:[(0,d.jsx)("strong",{children:null===(a=e.user)||void 0===a?void 0:a.firstName}),(0,d.jsx)("p",{children:e.content}),(0,d.jsx)("span",{className:"comment-time",children:L(e.createdAt)})]})]},e._id)})})]})]})}},5028:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(5043),o=s(6351),n=s(1321),r=s(579);const i=e=>{let{onPostCreated:t}=e;const[s,i]=(0,a.useState)(""),[c,l]=(0,a.useState)([]),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(""),{user:p}=(0,o.A)();return(0,r.jsxs)("div",{className:"create-post-card",children:[(0,r.jsxs)("div",{className:"post-header",children:[(0,r.jsx)("img",{src:(null===p||void 0===p?void 0:p.profilePicture)||"/default-avatar.jpg",alt:null===p||void 0===p?void 0:p.firstName,className:"user-avatar"}),(0,r.jsxs)("div",{className:"user-info",children:[(0,r.jsxs)("h4",{children:[null===p||void 0===p?void 0:p.firstName," ",null===p||void 0===p?void 0:p.lastName]}),(0,r.jsx)("p",{children:"What\u2019s on your mind?"})]})]}),(0,r.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0),h("");try{const e=new FormData;e.append("content",s),c.forEach(t=>e.append("images",t));const a=await n.A.post("/api/posts",e,{headers:{"Content-Type":"multipart/form-data"}});a.data&&(i(""),l([]),t&&t(a.data))}catch(r){var a,o;h((null===(a=r.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)||"Failed to create post")}finally{u(!1)}},className:"post-form",children:[(0,r.jsx)("textarea",{value:s,onChange:e=>i(e.target.value),placeholder:"Share something with your community...",maxLength:1e3,rows:3,required:!0}),c.length>0&&(0,r.jsx)("div",{className:"image-preview-container",children:c.map((e,t)=>(0,r.jsxs)("div",{className:"image-preview",children:[(0,r.jsx)("img",{src:URL.createObjectURL(e),alt:"Preview ".concat(t),className:"preview-image"}),(0,r.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>(e=>{l(t=>t.filter((t,s)=>s!==e))})(t),children:"\xd7"})]},t))}),m&&(0,r.jsx)("div",{className:"error-message",children:m}),(0,r.jsxs)("div",{className:"post-actions",children:[(0,r.jsxs)("div",{className:"action-buttons",children:[(0,r.jsx)("label",{htmlFor:"image-upload",className:"file-input-label",children:"\ud83d\udcf7 Add Photos"}),(0,r.jsx)("input",{id:"image-upload",type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files).filter(e=>e.type.startsWith("image/"));0!==t.length&&l(e=>[...e,...t])},className:"file-input"})]}),(0,r.jsx)("button",{type:"submit",disabled:d||!s.trim()&&0===c.length,className:"post-button",children:d?"Posting...":"Post"})]})]})]})}},6351:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(5043);s(9722);s(579);const o=(0,a.createContext)(),n=()=>{const e=(0,a.useContext)(o);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}}}]);
//# sourceMappingURL=317.e8da4496.chunk.js.map