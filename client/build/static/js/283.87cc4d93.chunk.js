"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[283],{1321:(e,t,s)=>{s.d(t,{A:()=>o});const a=s(9722).A.create({baseURL:"http://localhost:5000/api",timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});const o=a},2266:(e,t,s)=>{s.d(t,{A:()=>o});const a=s(9722).A.create({baseURL:"http://localhost:5000",timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});const o=a},3283:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(5043),o=s(6351),n=s(5028),r=s(2555),i=s(3884),c=s(1321),l=s(579);const d=()=>{const{user:e}=(0,o.A)(),[t,s]=(0,a.useState)([]),[n,d]=(0,a.useState)(!0),[m,u]=(0,a.useState)(""),[p,h]=(0,a.useState)(1),[v,j]=(0,a.useState)(!0),x=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{const t=await c.A.get("/api/posts?page=".concat(e,"&limit=10"));if("success"===t.data.status){const a=t.data.data.posts;s(t=>1===e?a:[...t,...a]),j(e<t.data.pagination.pages)}}catch(t){console.error("Error fetching posts:",t),u("Failed to load posts.")}finally{d(!1)}};(0,a.useEffect)(()=>{x()},[]);const g=async t=>{try{const a=await c.A.post("/api/posts/".concat(t,"/like"));if("success"===a.data.status){const{liked:o}=a.data.data;s(s=>s.map(s=>s._id===t?(0,r.A)((0,r.A)({},s),{},{likes:o?[...s.likes,e._id]:s.likes.filter(t=>t!==e._id)}):s))}}catch(a){console.error("Error liking post:",a)}},N=async(e,t)=>{try{const a=await c.A.post("/api/posts/".concat(e,"/comments"),{content:t});if("success"===a.data.status){const t=a.data.data.comment;s(s=>s.map(s=>s._id===e?(0,r.A)((0,r.A)({},s),{},{comments:[...s.comments,t]}):s))}}catch(a){console.error("Error adding comment:",a)}};return n&&0===t.length?(0,l.jsx)("div",{className:"loading",children:"Loading posts..."}):m?(0,l.jsx)("div",{className:"error",children:m}):(0,l.jsxs)("div",{className:"post-feed",children:[t.map(e=>(0,l.jsx)(i.A,{post:e,onLike:g,onComment:N},e._id)),v&&(0,l.jsx)("button",{className:"load-more-btn",onClick:()=>{if(!n&&v){const e=p+1;h(e),x(e)}},disabled:n,children:n?"Loading...":"Load More"})]})},m=()=>{const{user:e}=(0,o.A)(),[t,s]=(0,a.useState)(0);return(0,l.jsx)("div",{className:"dashboard",children:(0,l.jsxs)("div",{className:"dashboard-content",children:[(0,l.jsx)("aside",{className:"sidebar",children:(0,l.jsxs)("div",{className:"user-card",children:[(0,l.jsx)("img",{src:(null===e||void 0===e?void 0:e.profilePicture)||"/default-avatar.jpg",alt:(null===e||void 0===e?void 0:e.firstName)||"User",className:"user-avatar-large"}),(0,l.jsxs)("h3",{children:[null===e||void 0===e?void 0:e.firstName," ",null===e||void 0===e?void 0:e.lastName]}),(0,l.jsxs)("p",{children:["@",null===e||void 0===e?void 0:e.username]})]})}),(0,l.jsxs)("main",{className:"main-feed",children:[(0,l.jsx)(n.A,{onPostCreated:()=>{s(e=>e+1)}}),(0,l.jsx)(d,{},t)]}),(0,l.jsx)("aside",{className:"sidebar",children:(0,l.jsx)("div",{className:"trending-section",children:(0,l.jsx)("h3",{children:"Trending Topics"})})})]})})}},3884:(e,t,s)=>{s.d(t,{A:()=>m});var a=s(2555),o=s(5043),n=s(2266);const r=async(e,t)=>{try{return(await n.A.post("/api/posts/".concat(e,"/reactions"),{type:t})).data}catch(a){var s;throw(null===(s=a.response)||void 0===s?void 0:s.data)||a}},i=async e=>{try{return(await n.A.delete("/api/posts/".concat(e,"/reactions"))).data}catch(s){var t;throw(null===(t=s.response)||void 0===t?void 0:t.data)||s}},c=async e=>{try{return(await n.A.get("/api/posts/".concat(e,"/reactions/me"))).data}catch(a){var t,s;if(404===(null===(t=a.response)||void 0===t?void 0:t.status))return null;throw(null===(s=a.response)||void 0===s?void 0:s.data)||a}};var l=s(6351),d=s(579);const m=e=>{var t,s,n,m;let{post:u,onComment:p}=e;const[h,v]=(0,o.useState)(null),[j,x]=(0,o.useState)(u.reactionCounts||{}),[g,N]=(0,o.useState)(!1),[f,b]=(0,o.useState)(""),[y,w]=(0,o.useState)(!1),{user:A}=(0,l.A)(),k=async()=>{try{const e=await c(u._id);v((null===e||void 0===e?void 0:e.userReaction)||null)}catch(e){console.error("Error loading user reaction:",e)}};(0,o.useEffect)(()=>{k()},[u._id,k]);const S=async e=>{try{if(h===e)await i(u._id),v(null),x(t=>(0,a.A)((0,a.A)({},t),{},{[e]:Math.max(0,(t[e]||0)-1)}));else{const t=await r(u._id,e);v(e),x(t.reactionCounts)}N(!1)}catch(t){console.error("Error handling reaction:",t)}},C=e=>{switch(e){case"like":default:return"\ud83d\udc4d";case"love":return"\u2764\ufe0f";case"haha":return"\ud83d\ude04";case"wow":return"\ud83d\ude32";case"sad":return"\ud83d\ude22";case"angry":return"\ud83d\ude20";case"dislike":return"\ud83d\udc4e"}},P=()=>Object.values(j).reduce((e,t)=>e+t,0),L=e=>new Date(e).toLocaleDateString("en-US",{hour:"2-digit",minute:"2-digit"});return(0,d.jsxs)("div",{className:"post-card",children:[(0,d.jsxs)("div",{className:"post-header",children:[(0,d.jsx)("img",{src:(null===(t=u.user)||void 0===t?void 0:t.profilePicture)||"/default-avatar.jpg",alt:null===(s=u.user)||void 0===s?void 0:s.firstName,className:"post-avatar"}),(0,d.jsxs)("div",{className:"post-user-info",children:[(0,d.jsxs)("h4",{children:[null===(n=u.user)||void 0===n?void 0:n.firstName," ",null===(m=u.user)||void 0===m?void 0:m.lastName]}),(0,d.jsx)("span",{className:"post-time",children:L(u.createdAt)})]})]}),(0,d.jsxs)("div",{className:"post-content",children:[(0,d.jsx)("p",{children:u.content}),u.image&&(0,d.jsx)("img",{src:u.image,alt:"Post",className:"post-image"})]}),(0,d.jsxs)("div",{className:"post-stats",children:[P()>0&&(0,d.jsxs)("span",{children:[P()," reactions"]}),(0,d.jsxs)("span",{children:[u.comments.length," comments"]})]}),(0,d.jsxs)("div",{className:"post-actions",children:[(0,d.jsxs)("button",{className:"action-btn ".concat(h?"active":""),onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),onClick:()=>S("like"),children:[h?C(h):"\ud83d\udc4d"," ",h?"Reacted":"React"]}),(0,d.jsx)("button",{onClick:()=>w(!y),className:"action-btn",children:"\ud83d\udcac Comment"}),(0,d.jsx)("button",{className:"action-btn",children:"\ud83d\udd04 Share"})]}),g&&(0,d.jsx)("div",{className:"reaction-picker",onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),children:["like","love","haha","wow","sad","angry","dislike"].map(e=>(0,d.jsx)("button",{className:"reaction-option",onClick:()=>S(e),title:e.charAt(0).toUpperCase()+e.slice(1),children:C(e)},e))}),y&&(0,d.jsxs)("div",{className:"comments-section",children:[(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),f.trim()&&(p(u._id,f.trim()),b(""))},className:"comment-form",children:[(0,d.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),placeholder:"Write a comment...",className:"comment-input"}),(0,d.jsx)("button",{type:"submit",disabled:!f.trim(),children:"Post"})]}),(0,d.jsx)("div",{className:"comments-list",children:u.comments.map(e=>{var t,s,a;return(0,d.jsxs)("div",{className:"comment",children:[(0,d.jsx)("img",{src:(null===(t=e.user)||void 0===t?void 0:t.profilePicture)||"/default-avatar.jpg",alt:null===(s=e.user)||void 0===s?void 0:s.firstName,className:"comment-avatar"}),(0,d.jsxs)("div",{className:"comment-content",children:[(0,d.jsx)("strong",{children:null===(a=e.user)||void 0===a?void 0:a.firstName}),(0,d.jsx)("p",{children:e.content}),(0,d.jsx)("span",{className:"comment-time",children:L(e.createdAt)})]})]},e._id)})})]})]})}},5028:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(5043),o=s(6351),n=s(1321),r=s(579);const i=e=>{let{onPostCreated:t}=e;const[s,i]=(0,a.useState)(""),[c,l]=(0,a.useState)([]),[d,m]=(0,a.useState)(!1),[u,p]=(0,a.useState)(""),{user:h}=(0,o.A)();return(0,r.jsxs)("div",{className:"create-post-card",children:[(0,r.jsxs)("div",{className:"post-header",children:[(0,r.jsx)("img",{src:(null===h||void 0===h?void 0:h.profilePicture)||"/default-avatar.jpg",alt:null===h||void 0===h?void 0:h.firstName,className:"user-avatar"}),(0,r.jsxs)("div",{className:"user-info",children:[(0,r.jsxs)("h4",{children:[null===h||void 0===h?void 0:h.firstName," ",null===h||void 0===h?void 0:h.lastName]}),(0,r.jsx)("p",{children:"What\u2019s on your mind?"})]})]}),(0,r.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),m(!0),p("");try{const e=new FormData;e.append("content",s),c.forEach(t=>e.append("images",t));const a=await n.A.post("/api/posts",e,{headers:{"Content-Type":"multipart/form-data"}});a.data&&(i(""),l([]),t&&t(a.data))}catch(r){var a,o;p((null===(a=r.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)||"Failed to create post")}finally{m(!1)}},className:"post-form",children:[(0,r.jsx)("textarea",{value:s,onChange:e=>i(e.target.value),placeholder:"Share something with your community...",maxLength:1e3,rows:3,required:!0}),c.length>0&&(0,r.jsx)("div",{className:"image-preview-container",children:c.map((e,t)=>(0,r.jsxs)("div",{className:"image-preview",children:[(0,r.jsx)("img",{src:URL.createObjectURL(e),alt:"Preview ".concat(t),className:"preview-image"}),(0,r.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>(e=>{l(t=>t.filter((t,s)=>s!==e))})(t),children:"\xd7"})]},t))}),u&&(0,r.jsx)("div",{className:"error-message",children:u}),(0,r.jsxs)("div",{className:"post-actions",children:[(0,r.jsxs)("div",{className:"action-buttons",children:[(0,r.jsx)("label",{htmlFor:"image-upload",className:"file-input-label",children:"\ud83d\udcf7 Add Photos"}),(0,r.jsx)("input",{id:"image-upload",type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files).filter(e=>e.type.startsWith("image/"));0!==t.length&&l(e=>[...e,...t])},className:"file-input"})]}),(0,r.jsx)("button",{type:"submit",disabled:d||!s.trim()&&0===c.length,className:"post-button",children:d?"Posting...":"Post"})]})]})]})}},6351:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(5043);s(9722);s(579);const o=(0,a.createContext)(),n=()=>{const e=(0,a.useContext)(o);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}}}]);
//# sourceMappingURL=283.87cc4d93.chunk.js.map