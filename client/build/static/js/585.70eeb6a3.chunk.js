"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[585],{8585:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Z});var o=s(9379),r=s(5043),a=s(172),i=s(5895),n=s(3969),l=s(2097),c=s(4527),d=s(3309),p=s(2843),x=s(1773),u=s(3216),h=s(8729),m=s(3862),A=s(7873),f=s(2579),j=s(3411),v=s(5465),b=s(3785),g=s(5362),y=s(9722);const k="https://your-deployed-backend.com/api",w=async(e,t)=>{const s=new FormData;s.append("avatar",e);return(await y.A.post("".concat(k,"/uploads/profile"),s,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(t)}})).data},C=async(e,t)=>{const s=new FormData;e.forEach(e=>{s.append("images",e)});return(await y.A.post("".concat(k,"/uploads/post"),s,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(t)}})).data},S=async(e,t)=>(await y.A.delete("".concat(k,"/uploads/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}})).data;var P=s(579);function z(e){let{type:t="profile",currentUrl:s="",size:o=120,multiple:c=!1,maxFiles:d=10,disabled:p=!1,onUploadComplete:x}=e;const[u,h]=(0,r.useState)(!1),[m,y]=(0,r.useState)(!1),[k,z]=(0,r.useState)(""),U=(0,r.useRef)(null),I=localStorage.getItem("token"),D=async e=>{if(e&&0!==e.length){h(!0),z(""),y(!1);try{let s;if("post"===t){const t=Array.from(e).filter(e=>e.type.startsWith("image/"));s=await C(t,I),x&&x(s.fileUrls)}else{const t=e[0];if(t.size>5242880)return void z("File size must be less than 5MB");s=await w(t,I),x&&x(s.url)}y(!0),setTimeout(()=>y(!1),3e3)}catch(r){var s,o;z((null===(s=r.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||"Upload failed. Try again.")}finally{h(!1)}}};return(0,P.jsxs)(n.A,{sx:{textAlign:"center"},children:["post"!==t&&(0,P.jsxs)(n.A,{sx:{position:"relative",width:o,height:o,mb:2,mx:"auto"},children:[(0,P.jsx)(A.A,{src:s,sx:{width:o,height:o,fontSize:.4*o},children:!s&&(0,P.jsx)(j.A,{fontSize:"inherit"})}),u&&(0,P.jsx)(a.A,{size:.5*o,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}),(0,P.jsx)("input",{type:"file",accept:"image/*",ref:U,multiple:"post"===t&&c,style:{display:"none"},onChange:e=>D(e.target.files),disabled:p||u}),(0,P.jsxs)(n.A,{sx:{display:"flex",justifyContent:"center",gap:1,flexWrap:"wrap"},children:[(0,P.jsx)(l.A,{component:"span",variant:"outlined",color:k?"error":m?"success":"primary",disabled:p||u,onClick:()=>U.current.click(),startIcon:u?(0,P.jsx)(a.A,{size:20}):m?(0,P.jsx)(v.A,{}):k?(0,P.jsx)(b.A,{}):(0,P.jsx)(j.A,{}),children:u?"Uploading...":k?"Retry":m?"Success!":"post"===t?"Upload Images":s?"Change":"Upload"}),s&&"post"!==t&&(0,P.jsx)(f.A,{color:"error",onClick:async()=>{try{h(!0),await S(t,I),x&&x(""),y(!0)}catch(e){z("Failed to remove image")}finally{h(!1)}},disabled:u,children:(0,P.jsx)(g.A,{})})]}),"post"===t&&(0,P.jsxs)(n.A,{sx:{border:"2px dashed #aaa",borderRadius:2,p:2,mt:2,cursor:"pointer"},onDrop:e=>{e.preventDefault(),"post"===t&&D(e.dataTransfer.files)},onDragOver:e=>e.preventDefault(),onClick:()=>U.current.click(),children:[(0,P.jsx)(i.A,{variant:"body2",color:"textSecondary",children:"Drag & drop images here or click to browse"}),(0,P.jsx)(i.A,{variant:"caption",children:c?"Up to ".concat(d," images"):"Single image only"})]}),k&&(0,P.jsx)(i.A,{color:"error",variant:"caption",sx:{mt:1,display:"block"},children:k})]})}var U=s(1244),I=s(7240),D=s(8578),F=s(6128),_=s(6154),E=s(5837),R=s(8672),W=s(2043),T=s(9519),B=s(6625);let N=(0,s(2104).io)("https://your-deployed-backend.com/api",{autoConnect:!1,transports:["websocket"]});const M=N;const O=function(e){var t,s;let{post:o}=e;const{user:a}=(0,r.useContext)(h.c),[d,p]=(0,r.useState)((null===(t=o.likes)||void 0===t?void 0:t.length)||0),[x,u]=(0,r.useState)(!1),[m,j]=(0,r.useState)("");return(0,r.useEffect)(()=>(M.on("post-liked",e=>{let{postId:t,likesCount:s}=e;t===o._id&&p(s)}),()=>{M.off("post-liked")}),[o._id]),(0,P.jsxs)(U.A,{sx:{mb:3,borderRadius:"20px",background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 30px rgba(0, 0, 0, 0.1)"},children:[(0,P.jsx)(I.A,{avatar:(0,P.jsx)(A.A,{src:o.user.avatar||"/default-avatar.png"}),title:o.user.username,subheader:(0,T.A)(new Date(o.createdAt),{addSuffix:!0}),action:(0,P.jsx)(f.A,{children:(0,P.jsx)(W.A,{})}),sx:{pb:0}}),(0,P.jsx)(D.A,{component:"img",height:"500",image:o.image||"/placeholder.jpg",sx:{borderRadius:"15px",m:2,boxShadow:"4px 4px 8px #ccc, -4px -4px 8px #fff"}}),(0,P.jsxs)(F.A,{children:[(0,P.jsx)(i.A,{variant:"body1",sx:{mb:2},children:o.content}),(0,P.jsx)(c.A,{sx:{my:2}}),(0,P.jsxs)(n.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,P.jsx)(B.P.span,{onClick:()=>{p(x?d-1:d+1),u(!x),M.emit("like-post",{postId:o._id,userId:a._id})},whileTap:{scale:1.5},animate:{scale:x?[1,1.2,1]:1},style:{display:"inline-block",cursor:"pointer"},children:(0,P.jsx)(E.A,{color:x?"error":"disabled"})}),(0,P.jsx)(i.A,{children:d}),(0,P.jsx)(f.A,{children:(0,P.jsx)(R.A,{})}),(0,P.jsx)(i.A,{children:(null===(s=o.comments)||void 0===s?void 0:s.length)||0})]}),(0,P.jsxs)(n.A,{sx:{mt:2,display:"flex",gap:1},children:[(0,P.jsx)(_.A,{fullWidth:!0,size:"small",placeholder:"Write a comment...",value:m,onChange:e=>j(e.target.value)}),(0,P.jsx)(l.A,{variant:"contained",onClick:()=>{m.trim()&&(M.emit("send-notification",{userId:o.user._id,message:"".concat(a.username," commented on your post")}),j(""))},children:"Send"})]})]})]})};var G=s(7034);function J(){return(0,P.jsx)("div",{className:"loading-overlay",children:(0,P.jsx)(G.A,{color:"#36d7b7",size:15})})}function L(){const{user:e}=(0,r.useContext)(h.c),[t,s]=(0,r.useState)([]),[o,a]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{const e=await m.Ay.get("/posts");s(e.data)}catch(e){console.error("Error fetching posts:",e)}finally{a(!1)}})()},[]);const i=async()=>{try{const e=await m.Ay.get("/posts");s(e.data)}catch(e){console.error("Error refreshing posts:",e)}};return o?(0,P.jsx)(J,{}):(0,P.jsx)(n.A,{sx:{mt:2},children:t.map(t=>(0,P.jsx)(O,{post:t,currentUser:e,onInteraction:i},t._id))})}function Z(){const{id:e}=(0,u.g)(),{user:t=null}=(0,r.useContext)(h.c)||{},[s,A]=(0,r.useState)(null),[f,j]=(0,r.useState)(!0),[v,b]=(0,r.useState)([]),[g,y]=(0,r.useState)(0),[k,w]=(0,r.useState)(!1),[C,S]=(0,r.useState)({bio:"",phone:"",profilePicture:"",coverPhoto:""}),U=(0,u.Zp)();(0,r.useEffect)(()=>{(async()=>{try{j(!0);const[{data:t},{data:s}]=await Promise.all([m.Ay.get("/users/".concat(e)),m.Ay.get("/posts?userId=".concat(e))]);A(t),b(s),S({bio:t.bio||"",phone:t.phone||"",profilePicture:t.profilePicture||"",coverPhoto:t.coverPhoto||""})}catch(t){console.error("Failed to fetch profile data",t),U("/")}finally{j(!1)}})()},[e,U]);if(f)return(0,P.jsx)(a.A,{sx:{display:"block",mx:"auto",mt:4}});if(!s)return(0,P.jsx)(i.A,{children:"User not found"});const I=(null===t||void 0===t?void 0:t._id)===s._id;return(0,P.jsxs)(n.A,{sx:{pb:4},children:[(0,P.jsx)(n.A,{sx:{height:300,background:C.coverPhoto?"url(".concat(C.coverPhoto,") center/cover"):"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)",position:"relative"},children:k&&(0,P.jsx)(n.A,{sx:{position:"absolute",bottom:16,right:16,bgcolor:"background.paper",p:1,borderRadius:1,boxShadow:3},children:(0,P.jsx)(z,{currentUrl:C.coverPhoto,onUploadComplete:e=>S((0,o.A)((0,o.A)({},C),{},{coverPhoto:e})),type:"cover",size:80})})}),(0,P.jsx)(n.A,{sx:{maxWidth:1200,mx:"auto",px:{xs:2,md:4},mt:-8,position:"relative"},children:(0,P.jsxs)(n.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"center",md:"flex-end"},gap:3},children:[(0,P.jsx)(n.A,{sx:{position:"relative",width:160,height:160,mt:-4},children:(0,P.jsx)(z,{currentUrl:C.profilePicture,onUploadComplete:e=>S((0,o.A)((0,o.A)({},C),{},{profilePicture:e})),type:"profile",size:160,disabled:!k})}),(0,P.jsxs)(n.A,{sx:{flexGrow:1},children:[(0,P.jsxs)(i.A,{variant:"h3",sx:{fontWeight:600},children:[s.firstName," ",s.lastName]}),(0,P.jsx)(i.A,{variant:"subtitle1",color:"text.secondary",children:s.email}),(0,P.jsx)(i.A,{variant:"body2",children:C.bio||"No bio yet"}),(0,P.jsxs)(i.A,{variant:"caption",children:["Joined ",new Date(s.createdAt).toLocaleDateString()]})]}),I&&(0,P.jsx)(l.A,{startIcon:(0,P.jsx)(x.A,{}),onClick:()=>{k&&S({bio:s.bio||"",phone:s.phone||"",profilePicture:s.profilePicture||"",coverPhoto:s.coverPhoto||""}),w(!k)},variant:"outlined",children:k?"Cancel":"Edit Profile"})]})}),k&&(0,P.jsx)(n.A,{sx:{maxWidth:600,mx:"auto",px:2,mt:3},children:(0,P.jsx)(l.A,{variant:"contained",onClick:async()=>{try{const{data:e}=await m.Ay.put("/users",C);A(e),w(!1)}catch(e){console.error("Failed to update profile",e)}},sx:{mt:2},children:"Save Changes"})}),(0,P.jsx)(c.A,{sx:{my:4}}),(0,P.jsxs)(n.A,{sx:{px:{xs:2,md:4}},children:[(0,P.jsxs)(d.A,{value:g,onChange:(e,t)=>y(t),sx:{mb:3},children:[(0,P.jsx)(p.A,{label:"Posts"}),(0,P.jsx)(p.A,{label:"Comments"})]}),0===g&&(0,P.jsx)(L,{posts:v}),1===g&&(0,P.jsx)(n.A,{sx:{mt:3},children:0===v.length?(0,P.jsx)(i.A,{variant:"body1",children:"No comments available."}):v.flatMap(e=>{var t;return null===(t=e.comments)||void 0===t?void 0:t.filter(e=>{var t;return(null===(t=e.user)||void 0===t?void 0:t.username)===s.username}).map(t=>{var s;return(0,P.jsxs)(n.A,{sx:{mb:2,p:2,border:"1px solid #ddd",borderRadius:2},children:[(0,P.jsxs)(i.A,{variant:"subtitle2",color:"text.secondary",children:["On post: ",null===(s=e.content)||void 0===s?void 0:s.substring(0,50),"..."]}),(0,P.jsx)(i.A,{variant:"body1",children:t.text})]},t._id)})})})]})]})}}}]);
//# sourceMappingURL=585.70eeb6a3.chunk.js.map