"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[733],{1733:(e,t,s)=>{s.r(t),s.d(t,{default:()=>S});var o=s(5043),r=s(1637),i=s(5865),a=s(6446),n=s(1906),l=s(9336),c=s(4669),d=s(4056),x=s(3560),u=s(3216),p=s(8729),h=s(8180),m=s(7830),A=s(7392),j=s(3552),f=s(9506),v=s(5896),b=s(3768),g=s(579);function y(e){let{currentUrl:t,onUploadComplete:s,type:l="profile",size:c=100,disabled:d=!1}=e;const[x,u]=(0,o.useState)(!1),[p,y]=(0,o.useState)(null),[C,S]=(0,o.useState)(!1);return(0,g.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,g.jsxs)(a.A,{sx:{position:"relative",width:c,height:c,mb:2},children:[(0,g.jsx)(m.A,{src:t,sx:{width:"100%",height:"100%",fontSize:.4*c},children:!t&&(0,g.jsx)(j.A,{fontSize:"inherit"})}),x&&(0,g.jsx)(r.A,{size:.5*c,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}),(0,g.jsx)("input",{accept:"image/*",style:{display:"none"},id:`${l}-upload-input`,type:"file",onChange:async e=>{const t=e.target.files[0];if(t)if(t.size>5242880)y("File size must be less than 5MB");else{u(!0),y(null),S(!1);try{const e=new FormData;e.append("image",t);const{data:o}=await h.Ay.post(`/uploads/${l}`,e,{headers:{"Content-Type":"multipart/form-data"}});s(o.url),S(!0),setTimeout(()=>S(!1),3e3)}catch(i){var o,r;y((null===(o=i.response)||void 0===o||null===(r=o.data)||void 0===r?void 0:r.message)||"Upload failed. Please try again.")}finally{u(!1),e.target.value=""}}},disabled:d||x}),(0,g.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,g.jsx)("label",{htmlFor:`${l}-upload-input`,children:(0,g.jsx)(n.A,{component:"span",variant:"outlined",color:p?"error":C?"success":"primary",disabled:d||x,startIcon:x?(0,g.jsx)(r.A,{size:20}):C?(0,g.jsx)(f.A,{}):p?(0,g.jsx)(v.A,{}):(0,g.jsx)(j.A,{}),children:x?"Processing...":p?"Error":C?"Success!":t?"Change":"Upload"})}),t&&!d&&(0,g.jsx)(A.A,{color:"error",onClick:async()=>{try{u(!0),await h.Ay.delete(`/uploads/${l}`),s(""),S(!0),setTimeout(()=>S(!1),3e3)}catch(e){y("Failed to remove image")}finally{u(!1)}},disabled:x,children:(0,g.jsx)(b.A,{})})]}),p&&(0,g.jsx)(i.A,{color:"error",variant:"caption",sx:{mt:1},children:p})]})}var C=s(7821);function S(){const{id:e}=(0,u.g)(),{user:t=null}=(0,o.useContext)(p.c)||{},[s,m]=(0,o.useState)(null),[A,j]=(0,o.useState)(!0),[f,v]=(0,o.useState)([]),[b,S]=(0,o.useState)(0),[P,k]=(0,o.useState)(!1),[w,z]=(0,o.useState)({bio:"",phone:"",profilePicture:"",coverPhoto:""}),I=(0,u.Zp)();(0,o.useEffect)(()=>{(async()=>{try{j(!0);const[{data:t},{data:s}]=await Promise.all([h.Ay.get(`/users/${e}`),h.Ay.get(`/posts?userId=${e}`)]);m(t),v(s),z({bio:t.bio||"",phone:t.phone||"",profilePicture:t.profilePicture||"",coverPhoto:t.coverPhoto||""})}catch(t){console.error("Failed to fetch profile data",t),I("/")}finally{j(!1)}})()},[e,I]);if(A)return(0,g.jsx)(r.A,{sx:{display:"block",mx:"auto",mt:4}});if(!s)return(0,g.jsx)(i.A,{children:"User not found"});const U=(null===t||void 0===t?void 0:t._id)===s._id;return(0,g.jsxs)(a.A,{sx:{pb:4},children:[(0,g.jsx)(a.A,{sx:{height:300,background:w.coverPhoto?`url(${w.coverPhoto}) center/cover`:"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)",position:"relative"},children:P&&(0,g.jsx)(a.A,{sx:{position:"absolute",bottom:16,right:16,bgcolor:"background.paper",p:1,borderRadius:1,boxShadow:3},children:(0,g.jsx)(y,{currentUrl:w.coverPhoto,onUploadComplete:e=>z({...w,coverPhoto:e}),type:"cover",size:80})})}),(0,g.jsx)(a.A,{sx:{maxWidth:1200,mx:"auto",px:{xs:2,md:4},mt:-8,position:"relative"},children:(0,g.jsxs)(a.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"center",md:"flex-end"},gap:3},children:[(0,g.jsx)(a.A,{sx:{position:"relative",width:160,height:160,mt:-4},children:(0,g.jsx)(y,{currentUrl:w.profilePicture,onUploadComplete:e=>z({...w,profilePicture:e}),type:"profile",size:160,disabled:!P})}),(0,g.jsxs)(a.A,{sx:{flexGrow:1},children:[(0,g.jsxs)(i.A,{variant:"h3",sx:{fontWeight:600},children:[s.firstName," ",s.lastName]}),(0,g.jsx)(i.A,{variant:"subtitle1",color:"text.secondary",children:s.email}),(0,g.jsx)(i.A,{variant:"body2",children:w.bio||"No bio yet"}),(0,g.jsxs)(i.A,{variant:"caption",children:["Joined ",new Date(s.createdAt).toLocaleDateString()]})]}),U&&(0,g.jsx)(n.A,{startIcon:(0,g.jsx)(x.A,{}),onClick:()=>{P&&z({bio:s.bio||"",phone:s.phone||"",profilePicture:s.profilePicture||"",coverPhoto:s.coverPhoto||""}),k(!P)},variant:"outlined",children:P?"Cancel":"Edit Profile"})]})}),P&&(0,g.jsx)(a.A,{sx:{maxWidth:600,mx:"auto",px:2,mt:3},children:(0,g.jsx)(n.A,{variant:"contained",onClick:async()=>{try{const{data:e}=await h.Ay.put("/users",w);m(e),k(!1)}catch(e){console.error("Failed to update profile",e)}},sx:{mt:2},children:"Save Changes"})}),(0,g.jsx)(l.A,{sx:{my:4}}),(0,g.jsxs)(a.A,{sx:{px:{xs:2,md:4}},children:[(0,g.jsxs)(c.A,{value:b,onChange:(e,t)=>S(t),sx:{mb:3},children:[(0,g.jsx)(d.A,{label:"Posts"}),(0,g.jsx)(d.A,{label:"Comments"})]}),0===b&&(0,g.jsx)(C.A,{posts:f}),1===b&&(0,g.jsx)(a.A,{sx:{mt:3},children:0===f.length?(0,g.jsx)(i.A,{variant:"body1",children:"No comments available."}):f.flatMap(e=>{var t;return null===(t=e.comments)||void 0===t?void 0:t.filter(e=>{var t;return(null===(t=e.user)||void 0===t?void 0:t.username)===s.username}).map(t=>{var s;return(0,g.jsxs)(a.A,{sx:{mb:2,p:2,border:"1px solid #ddd",borderRadius:2},children:[(0,g.jsxs)(i.A,{variant:"subtitle2",color:"text.secondary",children:["On post: ",null===(s=e.content)||void 0===s?void 0:s.substring(0,50),"..."]}),(0,g.jsx)(i.A,{variant:"body1",children:t.text})]},t._id)})})})]})]})}},7821:(e,t,s)=>{s.d(t,{A:()=>z});var o=s(5043),r=s(6446),i=s(8729),a=s(8180),n=s(2110),l=s(9958),c=s(7830),d=s(7392),x=s(6591),u=s(6494),p=s(5865),h=s(9336),m=s(5795),A=s(1906),j=s(6520),f=s(835),v=s(8082),b=s(853),g=s(6625);const y=(0,s(2104).io)("http://localhost:5000",{autoConnect:!1}),C=y;var S=s(579);const P=function(e){var t,s;let{post:a}=e;const{user:y}=(0,o.useContext)(i.c),[P,k]=(0,o.useState)((null===(t=a.likes)||void 0===t?void 0:t.length)||0),[w,z]=(0,o.useState)(!1),[I,U]=(0,o.useState)("");return(0,o.useEffect)(()=>(C.on("post-liked",e=>{let{postId:t,likesCount:s}=e;t===a._id&&k(s)}),()=>{C.off("post-liked")}),[a._id]),(0,S.jsxs)(n.A,{sx:{mb:3,borderRadius:"20px",background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 30px rgba(0, 0, 0, 0.1)"},children:[(0,S.jsx)(l.A,{avatar:(0,S.jsx)(c.A,{src:a.user.avatar||"/default-avatar.png"}),title:a.user.username,subheader:(0,b.m)(new Date(a.createdAt),{addSuffix:!0}),action:(0,S.jsx)(d.A,{children:(0,S.jsx)(v.A,{})}),sx:{pb:0}}),(0,S.jsx)(x.A,{component:"img",height:"500",image:a.image||"/placeholder.jpg",sx:{borderRadius:"15px",m:2,boxShadow:"4px 4px 8px #ccc, -4px -4px 8px #fff"}}),(0,S.jsxs)(u.A,{children:[(0,S.jsx)(p.A,{variant:"body1",sx:{mb:2},children:a.content}),(0,S.jsx)(h.A,{sx:{my:2}}),(0,S.jsxs)(r.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,S.jsx)(g.P.span,{onClick:()=>{k(w?P-1:P+1),z(!w),C.emit("like-post",{postId:a._id,userId:y._id})},whileTap:{scale:1.5},animate:{scale:w?[1,1.2,1]:1},style:{display:"inline-block",cursor:"pointer"},children:(0,S.jsx)(j.A,{color:w?"error":"disabled"})}),(0,S.jsx)(p.A,{children:P}),(0,S.jsx)(d.A,{children:(0,S.jsx)(f.A,{})}),(0,S.jsx)(p.A,{children:(null===(s=a.comments)||void 0===s?void 0:s.length)||0})]}),(0,S.jsxs)(r.A,{sx:{mt:2,display:"flex",gap:1},children:[(0,S.jsx)(m.A,{fullWidth:!0,size:"small",placeholder:"Write a comment...",value:I,onChange:e=>U(e.target.value)}),(0,S.jsx)(A.A,{variant:"contained",onClick:()=>{I.trim()&&(C.emit("send-notification",{userId:a.user._id,message:`${y.username} commented on your post`}),U(""))},children:"Send"})]})]})]})};var k=s(7034);function w(){return(0,S.jsx)("div",{className:"loading-overlay",children:(0,S.jsx)(k.A,{color:"#36d7b7",size:15})})}function z(){const{user:e}=(0,o.useContext)(i.c),[t,s]=(0,o.useState)([]),[n,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{const e=await a.Ay.get("/posts");s(e.data)}catch(e){console.error("Error fetching posts:",e)}finally{l(!1)}})()},[]);const c=async()=>{try{const e=await a.Ay.get("/posts");s(e.data)}catch(e){console.error("Error refreshing posts:",e)}};return n?(0,S.jsx)(w,{}):(0,S.jsx)(r.A,{sx:{mt:2},children:t.map(t=>(0,S.jsx)(P,{post:t,currentUser:e,onInteraction:c},t._id))})}}}]);
//# sourceMappingURL=733.9bb2d839.chunk.js.map